import random
import datetime import timedelta

class OTPService:
    @staticmethod
    def generate_otp(user_id, purpose, expiry_minutes =15)
    otp_code = str (random.randint(100000,999999))
    otp_expiry = datetime.datetime.now() + timedelta(minutes=expiry_minutes)
    otp =OTP(
        user_id=user_id,
        purpose=purpose,    
        otp_code=otp_code,
        otp_expiry=otp_expiry
    )  
    db.session.add(otp)
    db.session.commit
    
    return otp_code

@staticmethod
def verify_otp(user_id, otp_code, purpose):
        otp = OTP.query.filter_by(
            user_id=user_id, 
            otp_code=otp_code, 
            purpose=purpose, 
            is_used=False
        ).first()
        
        if otp and otp.expires_at > datetime.utcnow():
            otp.is_used = True
            db.session.commit()
            return True
                  return False
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       